{% extends 'base.html' %}
{% load static %}
{% block title %}
    {{ hospital.name }}
{% endblock %}

{% block css %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <link href="{% static 'css/details.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/cards.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/main.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/helper.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/stars.css' %}" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300&display=swap" rel="stylesheet">
{% endblock %}

{% block body %}
    {% include 'nav.html' %}
    <div class="container my-5 py-5">
        {% include 'v2/components/hospital_details_card.html' with marker=hospital id=hospital.id %}
        {% include 'v2/components/give_rating.html' %}
        {% include 'v2/components/susmodal.html' %}
    </div>

    <div class="text-center h2" id="reviews">Reviews</div>
    <div class="container mt-5">
        {% include 'v2/components/review_card.html' %}
    </div>
    <div hidden>
      {% include 'v2/components/sidebar.html' %}
    </div>
{% endblock %}

{% block script %}
    <script>
        function submitReview() {
            let affordability = $('input[name="affordability"]:checked').val() | 0
            let oxygenCare = $('input[name="oxygen-care"]:checked').val() | 0
            let conv = $('input[name="conv-care"]:checked').val() | 0
            let covidCare = $('input[name="covid-care-quality"]:checked').val() | 0
            let ventAvail = $('#Ventilator').val()
            let oxygenAvail = $('#Oxygen').val()
            let icuAvail = $('#ICU').val()
            let avgCost = $('#avgcost').val()
            let bedsAvail = $('#Bed').val()
            let comment = $('#textarea').val()
            let size = $('#size').val()
            let today = new Date().toLocaleDateString()
            console.log(conv)
            Review.create({
                financial_rating: affordability,
                avg_cost: avgCost,
                covid_rating: covidCare,
                care_rating: conv,
                oxygen_rating: oxygenCare,
                beds_available: bedsAvail,
                ventilator_availability: ventAvail,
                oxygen_availability: oxygenAvail,
                icu_availability: icuAvail,
                comment: comment,
                datef: today,
                size: size,
                marker:{{ hospital.id }}
            }).then(function (reviewobject) {
                console.log(reviewobject)
                $('#exampleModalLong').modal('toggle');
                addToast("Review Added", "Thank you for your valuable feedback!")
            }).catch(function (error) {
                const detail = error.detail
                console.log(detail)
                var current_path;
                if ('Authentication credentials were not provided.' === detail) {
                    current_path = window.location.pathname
                    window.location.href = '/login?next=' + current_path
                    addToast("Failed to Add Review", "Please Sign in to submit Reviews")


                } else if (detail) {
                    $('#exampleModalLong').modal('toggle');
                    addToast("Failed to Add Review", detail)
                } else {
                    addToast("Failed to Add Review", "Please Enter the Highlighted Values")

                }

            })
        }

        function submitSus() {
            let comment = $('#sustextarea').val()
            Sus.create({comment: comment, marker:{{ hospital.id }}}).then(function (reviewobject) {
                $('#susmodal').modal('toggle');
                addToast("Submitted", "Thank you for your valuable feedback")
            }).catch(function (error) {
                const detail = error.detail
                console.log(detail)
                var current_path;
                if ('Authentication credentials were not provided.' === detail) {
                    current_path = window.location.pathname
                    window.location.href = '/login?next=' + current_path
                    addToast("Failed to Submit", "Feedback wasnt submitted :(")

                } else {
                    addToast("Failed to Submit", "Feedback wasnt submitted :(")

                }
            })
        }


    </script>
{% endblock %}